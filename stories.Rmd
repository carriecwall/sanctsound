---
title: "Stories"
output:
  html_document:
    toc: true
    toc_depth: 2
    toc_float: true
    css: 
      - libs/masonry.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F, warning = F)
```

<script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>

```{r, results='asis'}
source("functions.R")

# rm(stories)
tbl_stories <- get_sheet("stories") %>% 
  filter(
    !is.na(image_gdrive_sharable_link)) %>% 
  mutate(
    img_rel = map_chr(image_gdrive_sharable_link, gdrive2path, relative_pfx = "")) %>% 
  filter(
    !is.na(img_rel))

story_grid_item <- function(title, img_rel, story_link, ...){
  if(is.na(story_link)){
     glue("
      <div class='grid-item'>
        <img src='{img_rel}' target='_blank'>
        <!--div class='grid-text'><span>{title}</span></div-->
      </div>")
  } else {
    glue("
      <div class='grid-item'>
        <a href='{story_link}'>
        <img src='{img_rel}'>
        <!--div class='grid-text'><span>{title}</span></div-->
        </a>
      </div>")
  }
}

regions_tbl <- tbl_stories %>% distinct(region) %>% pull(region)
regions <- c("National", "East Coast", "Hawaii", "West Coast")
stopifnot(length(setdiff(regions, regions_tbl)) == 0)
stopifnot(length(setdiff(regions_tbl, regions)) == 0)

for (rgn in regions){
  rgn_stories <- tbl_stories %>% 
    filter(region == rgn)
  
  if (nrow(rgn_stories) == 0) 
    next()
  
  cat(glue("\n\n\n## {rgn}\n\n<div class='grid'>\n\n", .trim = F))
  
  rgn_stories %>% 
    pmap_chr(story_grid_item) %>% 
    paste(collapse = "\n\n") %>% 
    cat()
  
  cat("\n\n</div>\n\n")
}
```

<script>
$('.grid').masonry({
  // options
  itemSelector: '.grid-item',
  columnWidth: 200
});
</script>

```{r, eval=F}
DT::datatable(tbl_stories)
```

<!--
- Overall
  - How loud is my sanctuary?
  - COVID-19 signals/impacts
- East Coast
  - Baleen whale & dolphin regional presence
  - COVID-19 signals/impacts
- Pacific Islands
  - Humpback whale-song occurrence
  - Human-made sound occurence
- West Coast
  - Ships & whales in OCNMS
  - Seal bombs in Monterey
-->