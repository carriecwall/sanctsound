---
title: "What did we hear?"
params:
  csv: "svg/svg_links.csv"
  svg: "svg/cinms_pelagic.svg"
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F)
```

_Ever moved to a new place and had to get used to how it sounds? Sometimes you know what is producing the sounds you hear right away as they are relatively common and sound about the same wherever you are (fire engine sirens, airplanes taking off, truck backing up). Other sounds might be harder to identify a source for: what bird makes that call? Is that a donkey braying in the distance?_

The 30 locations in 7 US National Marine Sanctuaries and 1 National Marine Monument in this project were selected to record ocean sounds over several years. We chose spots most likely to have sounds made by reef-living invertebrates like snapping shrimp, calling fish and whales, boats, explosions from fishing activities, sonars used in military training, to name a few expected and relatively well-characterized sources of sound in the ocean.

There are many more sounds of unknown origin in our data, but those that are well described and relatively consistent can be “detected” by automated processes. Because computers aren’t perfect, scientists verify the automated detection results. This process allows us to determine how the automated detector performed in different places, including how well it worked in a louder environment or for specific types of sound.

Only a few types of sounds were present at all recording locations. These include the underwater sound made by wind and waves, and boats. Some sounds were present over many locations, including sounds made by snapping shrimp and humpback whales. Still others were present in only one or a few locations, like calling groupers in the Florida Keys National Marine Sanctuary or calling Atlantic cod in the Stellwagen Bank National Marine Sanctuary.
Interactive infographics for each sanctuary showcase specific sources of sound that we identified and tracked through our recording effort. You can then explore when and where these sounds were recorded. You can even listen to examples of sounds recorded at these sites!

There are more ways to showcase the contributions of known sounds at recording locations. Sounds produced by animals often peak during specific hours of the day, month and year based on the roles the sound plays in the animals’ reproductive activity, feeding or migration. Sounds produced by animals are often constrained to specific tones or frequencies and tend to always sound the same. In other words, if you’ve heard one red grouper you’ve heard them all. Therefore, changes in levels or intensities of sound during different time periods can be linked to different animal sources. Similarly, the bursting of bubbles off boat propellers produce sounds with specific frequency content allowing levels of sound at lower frequencies to track boat presence around recording locations. Natural environmental forces like wind and wave activity produce sound underwater that is heightened at specific frequencies and can be used to track the presence of storm and other weather activity at recording locations.

[IMAGERY: sample infographic, sample recordings]

## Embed video

```{r}
vembedr::embed_vimeo(195622451, width = "100%")
```

## Streamgraphs

[streamgraphs.html](modals/streamgraphs.html)

## Infographic

```{r svg, child = '_svg-html_child.Rmd'}
```

## Generating spectrogram videos

```{r, warning=FALSE, message=F}
library(here)
library(fs)
library(htmltools)
library(av)  # install.packages("av")

dir_wav <- here("data/wav")

wavs <- list.files(dir_wav, full.names = T)

wav <- wavs[1]

# Demo sound included with av
wonderland <- system.file('samples/Synapsis-Wonderland.mp3', package='av')

if (F){
#if (!file.exists('spectrogram.mp4')){
  # Read first 5 sec of demo
  fft_data <- read_audio_fft(wonderland, end_time = 5.0)
  plot(fft_data)
  
  # Create new audio file with first 5 sec
  av_audio_convert(wonderland, 'test.mp3', total_time = 5)
  
  #> [1] "short.mp3"
  av_spectrogram_video(
    wonderland, output = 'spectrogram.mp4', width = 1280, height = 720, res = 144)
}

if (F){
  mp4 <- path_ext_set(wav, "mp4")
  av_spectrogram_video(wav, output = mp4, width = 1280, height = 720, res = 144)
}

#tags$video(id='spectrogram.mp4', type = "video/mp4",src = 'spectrogram.mp4', controls = "controls")

mp4 <- file.path("data/wav", basename(path_ext_set(wav, "mp4")))
tags$video(id=basename(mp4), type = "video/mp4",src = mp4, controls = "controls")
```

